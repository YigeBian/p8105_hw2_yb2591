---
title: "Homework 2"
author: "Yige Bian (yb2591)"
date: 2023-10-01
output: github_document
---

```{r setup, include = FALSE}
Sys.setenv(LANG = "en_US")
library(tidyverse)
library(readxl)
```
# Problem 1
```{r tidy ppols_month}
# Import data "pol-month" and define types of columns. 
# Warning: There are several '2' in column 'prez_gop' which should be treated the same as '1'.  
# Break up the variable 'mon', replace month number with month name, create 'president' variable, remove 'prez_dem' and 'prez_gop' and 'day'

pols_month = 
  read_csv("./data/pols-month.csv", col_types = "Dliiiliii") |>
  janitor::clean_names() |>
  mutate(prez_gop = replace(prez_gop, is.na(prez_gop), TRUE)) |>
  separate(mon, into = c("year","month","day"), sep = "-") |>
  mutate(
    month = 
      case_match(
        month,
        "01" ~ "January",
        "02" ~ "February",
        "03" ~ "March",
        "04" ~ "April",
        "05" ~ "May",
        "06" ~ "June",
        "07" ~ "July",
        "08" ~ "August",
        "09" ~ "September",
        "10" ~ "October",
        "11" ~ "November",
        "12" ~ "December"),
    president = case_match(
        prez_gop,
        TRUE ~ "gop",
        FALSE ~ "dem")) |>
  select(year, month, everything(), -day, -starts_with("prez")) 
```
```{r tidy snp}
# Import and clean data snp 
snp = 
  read_csv("./data/snp.csv", col_types = cols(date = col_date("%m/%d/%y"))) |>
  janitor::clean_names() |>
  separate(date, into = c("year","month","day"), sep = "-") |>
  mutate(
    year = 
      as.character(ifelse(as.numeric(year) >= 2050, as.numeric(year)-100, as.numeric(year)))) |>
  arrange(year, month) |>
  select(year, month, everything()) |>
  mutate(
    month = 
      case_match(
        month,
        "01" ~ "January",
        "02" ~ "February",
        "03" ~ "March",
        "04" ~ "April",
        "05" ~ "May",
        "06" ~ "June",
        "07" ~ "July",
        "08" ~ "August",
        "09" ~ "September",
        "10" ~ "October",
        "11" ~ "November",
        "12" ~ "December"))
```

```{r tidy unemployment}
# Import data unemployment and swith from wide to long format. 
unemployment =
  read_csv("./data/unemployment.csv", col_types = "cd") |>
  janitor::clean_names() |>
  pivot_longer(jan:dec,
               names_to = "month",
               values_to = "per_of_unemp") |>
  mutate(
    month = 
      case_match(
        month,
        "jan" ~ "January",
        "feb" ~ "February",
        "mar" ~ "March",
        "apr" ~ "April",
        "may" ~ "May",
        "jun" ~ "June",
        "jul" ~ "July",
        "aug" ~ "August",
        "sep" ~ "September",
        "oct" ~ "October",
        "nov" ~ "November",
        "dec" ~ "December"))
```

```{r merge pols_month, snp and unemployment}
merge_data = 
  left_join(pols_month, snp, by = c("year","month")) |>
  left_join(unemployment, by = c("year","month"))
```

After tidying three datasets, the dataset `pols-month` has `r nrow(pols_month)` rows and `r ncol(pols_month)` columns, and varaibles in this dataset are `r colnames(pols_month)`, the range of years is `r range(pols_month$year)`; The dataset `snp` has `r nrow(snp)` rows and `r ncol(snp)` columns, and varaibles in this dataset are `r colnames(snp)`, the range of years is `r range(snp$year)`; The dataset `unemployment` has `r nrow(unemployment)` rows and `r ncol(unemployment)` columns, and varaibles in this dataset are `r colnames(unemployment)`, the range of years is `r range(unemployment$year)`.
The resulting dataset merged by these three datasets has `r nrow(merge_data)` rows and `r ncol(merge_data)` columns, and varaibles in this dataset  are `r colnames(merge_data)`, the range of years is `r range(merge_data$year)`. We observed that the range of years are different in three datasets, so when we merge them with left_join based on the consequence of `pols_month`, `snp` and `unemployment`, the values of variables in `snp` would be NA in 1947-1949, and values of variables in `unemployment` would be NA in 1948 because these two datasets don't have data for these years.

# Problem 2
```{r Import and merge trash wheel data sets}
Mr_Trash_Wheel = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N549") |>
  janitor::clean_names() |>
  mutate(
    homes_powered = 
      weight_tons*500/30,
    which_Trash_Wheel = "Mr")

Prof_Trash_Wheel = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M96") |>
  janitor::clean_names() |>
  mutate(
    homes_powered = 
      weight_tons*500/30,
    year = as.character(year),
    which_Trash_Wheel = "Prof")

Gwyn_Trash_Wheel = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:K27") |>
  janitor::clean_names() |>
  mutate(
    homes_powered = 
      weight_tons*500/30,
    year = as.character(year),
    which_Trash_Wheel = "Gwyn")

Mr_Prof_Gwyn=bind_rows(Mr_Trash_Wheel,Prof_Trash_Wheel,Gwyn_Trash_Wheel)
```


